<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BPMN Modeler</title>
    <script>
      (function () {
        try {
          const storedTheme = localStorage.getItem('bpmn-theme-preference');
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          const theme = storedTheme ?? (prefersDark ? 'dark' : 'light');
          document.documentElement.dataset.theme = theme === 'dark' ? 'dark' : 'light';
        } catch (error) {
          console.warn('Unable to determine preferred theme during initialization.', error);
          document.documentElement.dataset.theme = 'light';
        }
      })();
    </script>
    <link rel="stylesheet" href="./styles/global.css" />
    <link rel="stylesheet" href="./src/modeler/style.css" />
  </head>
  <body>
    <div class="app">
      <header class="app-header">
        <div class="app-title">
          <span>BPMN Modeler</span>
        </div>
        <div class="action-bar">
          <div class="action-group">
            <button
              class="button icon-button primary"
              id="new-diagram"
              type="button"
              aria-label="Create a new diagram"
              title="Create a new diagram"
            >
              <svg aria-hidden="true" class="icon" viewBox="0 0 24 24" fill="none">
                <path
                  d="M12 5v14M5 12h14"
                  stroke="currentColor"
                  stroke-width="1.75"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span class="sr-only">New diagram</span>
            </button>
            <button
              class="button icon-button"
              id="import-file"
              type="button"
              aria-label="Import a BPMN file"
              title="Import a BPMN file"
            >
              <svg aria-hidden="true" class="icon" viewBox="0 0 24 24" fill="none">
                <path
                  d="M12 3v12m0 0l-4-4m4 4 4-4M5 21h14"
                  stroke="currentColor"
                  stroke-width="1.75"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span class="sr-only">Import file</span>
            </button>
            <button
              class="button icon-button"
              id="download-diagram"
              type="button"
              aria-label="Download the current BPMN diagram"
              title="Download the current BPMN diagram"
            >
              <svg aria-hidden="true" class="icon" viewBox="0 0 24 24" fill="none">
                <path
                  d="M12 21V9m0 0 4 4m-4-4-4 4M5 3h14"
                  stroke="currentColor"
                  stroke-width="1.75"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span class="sr-only">Download diagram</span>
            </button>
            <button
              class="button icon-button"
              id="share-diagram"
              type="button"
              aria-label="Share the current diagram as a viewer link"
              title="Share the current diagram as a viewer link"
            >
              <svg aria-hidden="true" class="icon" viewBox="0 0 24 24" fill="none">
                <path
                  d="M7.5 13a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9Zm9 11a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9ZM7.5 8.5l9 7"
                  stroke="currentColor"
                  stroke-width="1.75"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span class="sr-only">Share diagram</span>
            </button>
          </div>
          <div class="action-group">
            <button
              class="button icon-button file-browser-toggle"
              id="toggle-storage"
              type="button"
              aria-label="Open workspace storage"
              title="Open workspace storage"
            >
              <svg aria-hidden="true" class="icon" viewBox="0 0 24 24" fill="none">
                <path
                  d="M3.75 6.75A1.75 1.75 0 0 1 5.5 5h13a1.75 1.75 0 0 1 1.75 1.75v12.5A1.75 1.75 0 0 1 18.5 21h-13A1.75 1.75 0 0 1 3.75 19.25V6.75ZM3 9h18"
                  stroke="currentColor"
                  stroke-width="1.75"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span class="sr-only">Open storage</span>
            </button>
            <button
              class="button icon-button"
              type="button"
              id="theme-toggle"
              aria-pressed="false"
              aria-label="Activate dark mode"
              title="Activate dark mode"
            >
              <svg aria-hidden="true" class="icon icon-sun" viewBox="0 0 24 24" fill="none">
                <path
                  d="M12 5V3m0 18v-2m7-7h2M3 12h2m12.364-6.364 1.414-1.414M5.222 18.778l1.414-1.414m0-10.95-1.414-1.414m12.728 12.728-1.414-1.414M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"
                  stroke="currentColor"
                  stroke-width="1.75"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <svg aria-hidden="true" class="icon icon-moon" viewBox="0 0 24 24" fill="none">
                <path
                  d="M21 12.79A9 9 0 0 1 11.21 3a7 7 0 1 0 9.79 9.79Z"
                  stroke="currentColor"
                  stroke-width="1.75"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span class="sr-only">Toggle theme</span>
            </button>
          </div>
        </div>
      </header>
      <div class="app-body">
        <div class="canvas-wrapper">
          <div id="canvas"></div>
        </div>
        <div id="properties" class="properties-panel-parent"></div>
      </div>
      <div id="file-browser" class="file-browser hidden" aria-hidden="true">
        <div class="file-browser-card">
          <div class="file-browser-header">
            <h2>Workspace Storage</h2>
            <button class="button" id="close-storage">Close</button>
          </div>
          <div class="file-browser-body">
            <div class="tree-view" aria-live="polite">
              <ul id="storage-tree"></ul>
            </div>
            <div class="file-browser-actions">
              <div class="panel-card">
                <h3>Save Diagram</h3>
                <p class="storage-hint">Enter a path relative to the workspace root. Create folders as needed.</p>
                <form id="save-form">
                  <div class="input-group">
                    <label for="save-path">File path</label>
                    <input type="text" id="save-path" placeholder="diagrams/example.bpmn" />
                  </div>
                  <button type="submit" class="small-button primary">Save</button>
                </form>
              </div>
              <div class="panel-card">
                <h3>Create Folder</h3>
                <form id="folder-form">
                  <div class="input-group">
                    <label for="folder-path">Folder path</label>
                    <input type="text" id="folder-path" placeholder="diagrams/new-folder" />
                  </div>
                  <button type="submit" class="small-button">Create</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <input type="file" id="file-input" accept=".bpmn,.xml" hidden />
    <script type="module" src="/src/modeler/main.js"></script>
  </body>
</html>
